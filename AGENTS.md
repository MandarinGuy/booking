---
적용: 항상
---

Generated by IntelliJ AI based on repository scan (2025-08-31 16:52)

# AGENTS.md — 에이전트를 위한 실행 지침서 (booking)

본 문서는 사람용 README가 아닌, 코드 에이전트(코딩 봇)를 위한 실행 지침서입니다. 이 저장소의 실제 파일과 문서를 스캔해 확인된 사실만 기술합니다. 확인 불가능한 항목은 "확인 불가"로 명시합니다.

## 1) Title & Scope

- 목적: 이 파일은 에이전트를 위한 지침서입니다. 개발/운영 작업 자동화 시 준수 규칙과 명령을 제공합니다.
- 적용 범위: 단일 레포지토리(single repo), 단일 모듈 구조
    - 근거: `settings.gradle`에 `rootProject.name = 'booking'`만 정의되어 있으며 서브프로젝트 선언 없음.

## 2) Documentation Reference (docs 우선)

- 모든 작업 전/중에 `./docs` 디렉토리 문서를 우선적으로 참조하십시오.
- 주요 문서:
    - 아키텍처 규칙: `docs/specs/policy/application.md`
    - 도메인 개요: `docs/specs/domain.md`
    - API 명세: `docs/specs/api/*.md`
    - 인증/인가 정책 문서 틀: `docs/specs/policy/authentication.md`, `docs/specs/policy/authorization.md` (현재 비어 있음)
    - 작업 메모/할 일: `docs/devlog/*`, `docs/todo.md`
- 세부 설계나 정책 충돌 시: `docs/specs/policy/application.md`의 규칙을 최우선으로 따르십시오.

## 3) Project Setup

- JDK/Gradle/Spring Boot 버전
    - Java: 21 (근거: `build.gradle` → `java.toolchain.languageVersion = 21`)
    - Gradle Wrapper: 8.14.3 (근거: `gradle/wrapper/gradle-wrapper.properties` → `distributionUrl`)
    - Spring Boot: 3.5.4 (근거: `build.gradle` → `id 'org.springframework.boot' version '3.5.4'`)
- 빌드/의존성 설치
    - 명령: `./gradlew clean build`
    - 테스트는 JUnit Platform 사용, 테스트 프로필은 Gradle test 태스크에서 `spring.profiles.active=test`로 설정됨 (근거: `build.gradle` →
      tasks.named('test')).
- 로컬 실행
    - 명령: `./gradlew bootRun`
    - 활성 프로필: 기본 `local` (근거: `src/main/resources/application.yml` → `spring.profiles.active: local`)
    - DB 및 JWT 설정은 `application-local.yml` 참고. 민감정보는 환경변수로 덮어쓰기를 권장.
- 테스트 실행
    - 기본: `./gradlew test` (JUnit5, Spring Boot Test, Mockito, Security Test, ArchUnit 포함)
    - 테스트 시 프로필: `test` (근거: `build.gradle` test 태스크 설정)
- 코드 분석/품질 도구
    - SpotBugs 사용 (근거: `build.gradle` → `com.github.spotbugs` 플러그인). 일반 태스크: `spotbugsMain`, `spotbugsTest`.
    - 포매터/린터(Spotless/Checkstyle 등): 확인 불가 (저장소 내 설정/플러그인 없음).

## 4) Architecture Rules (준수 규칙)

- 전반: 헥사고날 아키텍처(Ports & Adapters)
    - 근거: `docs/specs/policy/application.md` 및 `src/test/java/.../arch/HexagonalArchitectureTest.java`
- 계층 및 패키지
    - domain: `org.mandarin.booking.domain` — 순수 모델/예외/커맨드/요청/응답 (프레임워크 의존 금지)
    - app: `org.mandarin.booking.app` — 유스케이스 서비스, 포트(`app/port`), 퍼시스턴스 포트/구현(`app/persist`), AOP 등
    - adapter: `org.mandarin.booking.adapter` — webapi, security 등 외부와의 접점
    - 아키텍처 테스트 강제: `HexagonalArchitectureTest` 층 규칙 참조.
- DDD/엔티티 규칙(요지)
    - Aggregate Root 공개 범위 준수, 도메인 엔티티는 domain 패키지에 위치.
    - DTO(요청/응답/커맨드)는 현재 domain에 위치하며 컨트롤러에서 변환하여 사용 (근거: policy 문서).
- 영속성(JPA)
    - 의존성: `spring-boot-starter-data-jpa`, DB: MySQL(H2 for test), P6Spy (근거: `build.gradle`)
    - 저장소 규약: Spring Data Repository 인터페이스는 `app/persist`에 위치 (예: `MemberRepository`, `ShowRepository`).
    - 트랜잭션 경계는 app 서비스 (예: `ShowCommandRepository`에 `@Transactional`).
- 보안(Spring Security/JWT)
    - JWT 파싱/인증: `adapter/security/JwtFilter`가 Authorization 헤더 `Bearer <token>` 처리 (근거 파일).
    - SecurityFilterChain 설정과 우선순위: `SecurityConfig`
        - @Order(1) `apiChain` → 직접 구현한 엔드포인트에 대한 인증/인가 설정. `api/**` 규율을 준수함.
        - @Order(2) `publicChain` → 그 외 경로 permitAll.
    - AuthenticationProvider: `adapter/security/CustomAuthenticationProvider` (구체 로직은 소스 참조).
- 메시징/캐시/검색
    - Kafka/Redis/Elasticsearch 사용: 확인 불가 (관련 의존성/설정 없음).

자세한 규칙은 `docs/specs/policy/application.md`를 준수하십시오.

## 5) Code Style & Readability Rules (읽기 좋은 코드 작성 규칙)

에이전트가 코드를 작성할 때 반드시 준수해야 하는 가독성 중심 규칙입니다.

5.1 네이밍

- 클래스/인터페이스: 명확한 도메인 언어 사용 (예: ShowRegisterer, PaymentGatewayClient)
- 메서드: 동사+목적어 (예: registerShow, validateToken, findMemberByEmail)
- 변수/필드: 축약 금지, 문맥 명확히 (예: memberEmail, jwtTokenSecret)
- 테스트 메서드: 시나리오 기반 네이밍 (예: shouldFailWhenPasswordIsInvalid)

5.2 OOP 원칙

- Tell, don’t ask: 데이터를 꺼내 연산하지 말고 객체에게 메시지를 보내라.
- SRP: 클래스는 한 가지 책임만. 메서드는 5~10줄 이내 유지.
- 불변 객체 지향: 값 객체(Value Object)는 final 필드와 팩토리 메서드 사용.
- 의미 있는 도메인 모델: Map<String, String> 대신 MemberProfile 같은 타입을 정의.

5.3 글 읽듯이 읽히는 코드

- 한 메서드는 하나의 이야기(스토리)를 표현해야 함.
- 중첩 if/else 최소화 → 조기 반환(early return) 활용.
- 숫자/문자열 리터럴은 상수화 (MAX_RETRY_COUNT, DATE_FORMAT_PATTERN).
- 체이닝 시 가독성 유지: 각 메서드 호출을 줄바꿈 정렬.

5.4 주석 규칙

- 기본 원칙: 코드 자체가 의도를 설명할 수 있도록 작성 → 불필요한 주석 금지.
- 허용되는 주석 위치/용도
- 인터페이스/추상 클래스: 계약(Contract) 설명
- 복잡한 알고리즘/비즈니스 규칙: 수학적 공식, 근거 논문, 외부 레퍼런스 출처 표기
- TODO/FIXME: 보완 필요시 명확한 설명과 함께 작성
- 금지: “어떻게 동작하는지”를 코드 그대로 설명하는 주석.

작업 시 반드시 `docs/specs/policy/application.md` 규칙을 따르십시오.

## 6) Commands (신뢰 가능한 명령만)

- Gradle Wrapper 사용을 강제합니다.

```bash
# 빌드
./gradlew clean build

# 단위/통합 테스트 (test 프로필로 실행)
./gradlew test

# SpotBugs 정적 분석
./gradlew spotbugsMain spotbugsTest

# 로컬 실행 (기본 활성 프로필: local)
./gradlew bootRun

# Docker로 MySQL 기동 (compose.yaml 기반)
docker compose up -d

# 통합 테스트만 별도 태깅 없음 → 전체 테스트 수행
./gradlew test
```

근거 파일/경로:

- `build.gradle` (plugins, dependencies, test 태스크)
- `src/main/resources/application.yml`, `application-local.yml`, `application-test.yml`
- `compose.yaml`

## 7) Contribution & PR Rules

- 브랜치/커밋/PR 규약: `.github/pull_request_template.md` 참조
- 권장 체크리스트(제안):
    - [ ] 모든 테스트 통과 (`./gradlew test`)
    - [ ] SpotBugs 통과 (`./gradlew spotbugsMain spotbugsTest`)
    - [ ] 아키텍처 테스트 통과 (`HexagonalArchitectureTest`)
    - [ ] docs/specs/* 업데이트 반영
- 코드 스타일 점검
    - [ ] 코드가 글 읽듯 자연스럽게 읽히는가? (네이밍, 메서드 길이, 역할 분리 확인)
    - [ ] 불필요한 주석이 없는가? 필요한 주석만 인터페이스/복잡 규칙에 존재하는가?
    - [ ] 모든 테스트/SpotBugs/아키텍처 테스트 통과 여부

## 8) Environments

- 프로필
    - local: 기본 활성 (근거: `application.yml`), MySQL 설정 및 JWT 시크릿 포함 (근거: `application-local.yml`).
    - test: H2 메모리 DB, JPA DDL auto create, JWT 설정 포함 (근거: `application-test.yml`).
    - prod: 파일 존재하나 내용 비어 있음 → 확인 불가.
- 필수 환경변수(권장 키)
    - `SPRING_DATASOURCE_URL`, `SPRING_DATASOURCE_USERNAME`, `SPRING_DATASOURCE_PASSWORD`
    - `JWT_TOKEN_SECRET`, `JWT_TOKEN_ACCESS`, `JWT_TOKEN_REFRESH`
    - 위 값은 실제 비밀을 포함하므로, 절대 저장소에 커밋하지 말고 실행 환경에서 주입하십시오. 현재 로컬 yml에는 예시 값이 존재하나, 운영에서는 환경변수로 덮어쓰기를 권장.

## 9) Limitations / Unknowns

- CI/CD(.github/workflows) 설정: 확인 불가.
- 코드 포매팅(Spotless/Checkstyle): 구성 없음 → 확인 불가.
- 마이그레이션 도구(Flyway/Liquibase): 확인 불가.
- 메시징(Kafka)/캐시(Redis)/검색(Elasticsearch): 사용 근거 없음 → 확인 불가.
- 배포(AWS/K8s): 설정/스크립트 부재 → 확인 불가.

향후 TODO(사람이 보완):

- prod 프로필 구성 및 비밀 주입 전략 정의
- CI 파이프라인 도입(.github/workflows)
- DB 마이그레이션 도구 채택 및 규약 수립
- 인증/인가 정책 문서(`authentication.md`, `authorization.md`) 구체화
- 코드 포매터 도입 여부 결정(Spotless/Checkstyle 등)

## 10) Appendix

- 모듈/계층 의존 개요(텍스트)
    - adapter(webapi, security) → app\(ports, services, persist adapters) → domain
    - domain은 프레임워크 비의존, app은 domain에만 의존, adapter는 app의 포트에 의존
- 주요 디렉터리
    - `src/main/java/org/mandarin/booking/BookingApplication.java` — Spring Boot 엔트리포인트
    - `src/main/java/org/mandarin/booking/adapter/webapi/*` — REST 컨트롤러/응답 래핑
    - `src/main/java/org/mandarin/booking/adapter/security/*` — 보안 구성/JWT 필터/프로바이더
    - `src/main/java/org/mandarin/booking/app/*` — 서비스, AOP, 포트, 퍼시스트 어댑터
    - `src/main/java/org/mandarin/booking/domain/*` — 도메인 모델과 DTO/커맨드
    - `src/test/java/...` — 단위/아키텍처/통합 테스트 스위트

## 11) Test

- TDD 원칙: 새로운 기능은 테스트부터 작성하고, `./gradlew test`로 검증하십시오.
- 테스트 정책 근거:
    - JUnit Platform 활성화 및 test 프로필 지정 (근거: `build.gradle` test 태스크)
    - 아키텍처 검증: `src/test/java/org/mandarin/booking/arch/HexagonalArchitectureTest.java`
    - Web/API 및 보안 단위/통합 테스트 예시: `src/test/java/org/mandarin/booking/webapi/**`, `adapter/security/**`
- 단위 vs 통합 테스트
    - 단위: 도메인/서비스 단위 로직 검증, 외부 의존 모킹(Mock) (예: Mockito)
    - 통합: Spring Context 기동, 필터/시큐리티/컨트롤러 경로 포함. 테스트 프로필 `test`와 H2 DB 사용.
- 자세한 내용은 `./docs/specs/policy/test.md`를 참조.

---

## 12) Documentation Authoring Rules (문서 작성 규칙)

- 적용 범위: `./docs/specs` 디렉토리의 모든 문서(todo.md 제외). 이 규칙은 문서를 자동으로 작성/갱신하는 에이전트를 위한 것입니다.
- 공통 원칙
    - 사실만 기술하고, 확인 불가한 항목은 반드시 "확인 불가"로 명시합니다. 근거 파일/경로를 문서 내에 링크로 첨부합니다.
    - 한국어를 기본으로 작성합니다. 코드/명령/경로는 코드블록으로 표시합니다.
    - 변경 시 일관된 섹션 순서와 템플릿을 유지합니다.
    - 예시 명령은 복사-붙여넣기 즉시 실행 가능한 상태로 제공합니다.

- 파일/이름 규칙
    - API 스펙: `docs/specs/api/<resource>_<action>.md` 또는 엔드포인트 의미가 드러나는 snake_case 파일명 사용
        - 근거: `docs/specs/api/login.md`, `member_register.md`, `show_register.md`, `reissue.md`
    - 정책 문서: `docs/specs/policy/<topic>.md`
        - 근거: `docs/specs/policy/application.md`, `authentication.md`, `authorization.md`, `test.md`
    - 도메인 설계: `docs/specs/domain.md`

- API 스펙 문서 템플릿
    1) 제목 생략 가능(현재 파일들은 섹션 위주). 최상단에 섹션 "요청/응답/테스트"를 포함합니다.
    2) 요청 섹션 구성
        - 메서드, 경로, 헤더 코드블록, 본문 JSON 예시(필수 필드 포맷 포함)
        - 실행 가능한 curl 예시를 제공
        - 근거 예시: `docs/specs/api/login.md`, `member_register.md`, `show_register.md`, `reissue.md`
    3) 응답 섹션 구성
        - 상태코드 명시, 응답 JSON 예시 제공(필수 필드 포함)
    4) 테스트 섹션 구성
        - 체크박스 형태의 수용 기준 리스트(`[x]/[ ]`) 사용. 실제 테스트 코드와 동기화합니다.
        - 체크리스트 항목은 구체적 조건/결과를 포함합니다.

- 도메인 문서 템플릿
    - 상단 개요(프로젝트/도메인 목적)
    - 도메인 모델 섹션
        - 각 Aggregate/Entity 별로: 표제 → 역할 설명(이탤릭), 속성 목록, 행위 목록, 관련 타입 목록
        - 근거 예시: `docs/specs/domain.md`

- 정책 문서 템플릿
    - 번호 있는 대제목(1., 2., 3. …)을 사용하여 규칙을 체계화
    - 레이어/의존/포트/보안/테스트 등 주제별 세부 항목을 불릿으로 상세화
    - 실제 코드/설정 파일 경로를 근거로 명시
    - "확인 불가"를 명확히 표기해 향후 TODO를 남김
    - 근거 예시: `docs/specs/policy/application.md`, `docs/specs/policy/test.md`

- 링크/근거 표기 규칙
    - 저장소 상대 경로 링크를 사용합니다(예: `build.gradle`, `src/main/...`).
    - 문서 말미 또는 섹션 말미에 "근거" 목록을 배치하여 신뢰 가능한 출처를 나열합니다.
    - 정책/가이드 문서에는 규칙 옆에 괄호로 근거를 병기해도 됩니다.

- 표기/형식 규칙
    - 헤더 레벨은 H2(##)부터 사용해 문서 내 구조를 안정적으로 유지합니다.
    - 코드/JSON/명령은 fenced code block 사용. JSON 예시에는 실제 키를 포함하되 민감정보는 예시 값으로 대체.
    - 에러/예외/상태코드는 명시적으로 표기(예: `400 Bad Request`, `401 Unauthorized`).
    - 체크박스는 `[x]`(충족) / `[ ]`(미충족) 형식으로 유지.

- 테스트와의 동기화
    - API 문서의 테스트 체크리스트는 실제 테스트(`src/test/java/...`)와 1:1로 대응하도록 작성/갱신합니다.
    - 새로운 테스트가 추가되면 해당 API 문서의 체크리스트도 즉시 업데이트합니다.
    - 근거: `src/test/java/org/mandarin/booking/webapi/**/POST_specs.java`, `adapter/security/*Test.java`,
      `arch/HexagonalArchitectureTest.java`

- 프로필/환경 기술 시 유의사항
    - 실제 yml의 키/값/프로필을 그대로 반영하고, 운영 비밀은 "환경변수로 주입"이라고만 적습니다.
    - 근거: `src/main/resources/application.yml`, `application-local.yml`, `application-test.yml`

- 금지 사항
    - 추측성 서술 금지("추정/아마도" 금지). 알 수 없는 항목은 "확인 불가".
    - 실행 불가한 모호한 명령 예시 금지. 검증되지 않은 외부 의존성 언급 금지.

- 예시 스니펫 스타일
    - curl: 실제 경로/헤더/본문 포함(예: `docs/specs/api/show_register.md`의 curl 예시)
  - JSON: 축약하지 말고 필요한 필드를 명시, 포맷은 pretty 또는 단일 라인 일관 유지.

---

근거 스니펫 링크/파일 경로 요약:

- `build.gradle`: 플러그인/의존성/테스트 태스크
- `settings.gradle`: 단일 모듈 확인
- `src/main/resources/application*.yml`: 프로필/환경 설정
- `compose.yaml`: 로컬 환경에서 MySQL 기동 설정
- `docs/specs/policy/application.md`: 아키텍처 및 작업 규칙
- `src/main/java/.../SecurityConfig.java`, `JwtFilter.java`: 보안 규칙
- `src/main/java/.../app/persist/*.java`: 영속성 포트/리포지토리 구조
